<style>
    body {
    font:15px arial,sans-serif;
    }
    h1 {
    margin: 0 0 10px 0;
    padding: 5px;
    font-size: 24px;
    background-color: #999;
    color: #fff;
    }

    table {
    margin: 30px;
    }
    th, td {
    padding: 5px;
    border: 1px solid #999;
    }
    th {
    background: #ccc;
    }
    tr:nth-child(odd) {
    background: #eee;
    }
    td a {
    color: #000;
    text-decoration: underline;
    }
    .textbox {
         border: 1px solid #848484;
         -webkit-border-radius: 30px;
         -moz-border-radius: 30px;
         border-radius: 30px;
         outline:0;
         height:25px;
         width: 275px;
         padding-left:10px;
         padding-right:10px;
     }
</style>
<h1>Best quotes page.</h1>
    <!-- Load Jquery from CDN  for easy DOM manipulations -->
    <script src="http://code.jquery.com/jquery-latest.min.js"    type="text/javascript"></script>
<!-- Insertion point for handlebars template -->
<center>
{{#if info}}
        <div class="alert success">{{info}}</div>
{{/if}}
{{#if error}}
        <div class="alert alert-danger">{{error}}</div>
{{/if}}
        <form class="form-inline" action="#" method="post" id="quoteAdd">        <!--onSubmit="window.open('/quotes')"-->
            <input class="form-control" type="text" placeholder="Quote" name="quote" required>
            <input class="form-control" type="text" placeholder="Author" name="author" required>
            <input class="form-control" type="text" placeholder="Date" name="year" required>
            <button type="button" onclick="addQuote()" class="btn btn-primary">Submit quote</button>
        </form>
    <!--<p1>You can add quotes if you <a href="/register">register</a>. Already have an account? <a href="/login">Login!</a></p1>-->

<table id="quoteTable">
    <thead>
    <tr>
        <th>ID</th>
        <th>Quote</th>
        <th>Author</th>
        <th>Year</th>
    </tr>
    </thead>

</table>
</center>
    <script>
        $(document).ready(getAllQuotes());

        function getAllQuotes (){
            clearTable();
            $.get("/api/v1/quotes",function(data,status,xhr){
                var quotes=data.quotes;
                for(var i=0;i<quotes.length;i++){
                    var row="<tr><td>"+escapeHtml(quotes[i].id)+"</td><td>"+escapeHtml(quotes[i].quote)+"</td><td>"+escapeHtml(quotes[i].author)+"</td><td>"+escapeHtml(quotes[i].year)+"</td></tr>"
                    $("#quoteTable").append(row);
                        }
            });
        };
        var entityMap = {
            "&": "&amp;",
            "<": "&lt;",
            ">": "&gt;",
            '"': '&quot;',
            "'": '&#39;',
            "/": '&#x2F;'
        };
        function escapeHtml(string) {
            return String(string).replace(/[&<>"'\/]/g, function (s) {
                return entityMap[s];
            });
        }
        function clearTable() {
            $("#quoteTable tr").remove();
        }
        function addQuote() {
            var param=$('#quoteAdd').serialize();
            console.log(param);
            var http = new XMLHttpRequest();
            var url = "/api/v1/quotes";
            http.open("POST", url, true);
            http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            http.onreadystatechange = function() {//Call a function when the state changes.
                if(http.readyState == 4) {
                    var data = JSON.parse(http.responseText);
                    console.log(data)
                    if(data.success){
                       alert("Quote added successfully!");
                        clearTable();
                        getAllQuotes();
                    }else{
                        alert("Error: "+data.data)
                    }
                }
            }
            http.send(param);
        }
    </script>
</div>
